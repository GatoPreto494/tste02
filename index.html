function checkPaymentMethod() {
    let paymentMethod = document.getElementById("forma-pagamento").value;
    let erroPagamento = document.getElementById("erro-pagamento");

    // Verifica se a forma de pagamento foi selecionada
    if (!paymentMethod) {
        erroPagamento.style.display = "block"; // Exibe o erro
        return;
    } else {
        erroPagamento.style.display = "none"; // Esconde o erro
    }

    // Se a localização já foi confirmada antes, apenas continua o processo
    if (localStorage.getItem("localizacaoConfirmada")) {
        proceedToOrder(); 
        return;
    }

    // Caso contrário, pede a geolocalização
    if ("geolocation" in navigator) {
        navigator.geolocation.getCurrentPosition(
            function (position) {
                const userLat = position.coords.latitude;
                const userLng = position.coords.longitude;

                console.log(`Localização do usuário: ${userLat}, ${userLng}`);

                // Salva a confirmação no localStorage
                localStorage.setItem("localizacaoConfirmada", "true");

                // Calcula a taxa de entrega e então continua o pedido
                calcularTaxaEntrega(userLat, userLng, function() {
                    proceedToOrder(); // Chama a função correta após obter a localização
                });

            },
            function (error) {
                console.error("Erro ao obter localização:", error);
                alert("⚠️ Você precisa permitir a localização para continuar!");

                // Se o usuário negar a localização, pode continuar mesmo assim (opcional)
                // proceedToOrder(); 
            }
        );
    } else {
        alert("Geolocalização não é suportada pelo seu navegador.");
    }
}
